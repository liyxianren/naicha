# 奶茶大作战 - 前端设计方案

## 🎮 游戏流程设计

### 1. 游戏大厅阶段
```
[首页]
  ├─ 创建房间 → [房间准备页]
  └─ 加入房间 → [房间准备页]
```

**功能点：**
- 创建房间：输入玩家昵称 → 生成6位房间码
- 加入房间：输入房间码 + 玩家昵称 → 加入房间

---

### 2. 房间准备阶段
```
[房间准备页]
  显示：
    - 房间码（6位）
    - 已加入玩家列表（1/4, 2/4, 3/4, 4/4）
    - 每个玩家的准备状态（未准备 / 已准备）

  操作：
    - [准备] 按钮
    - [开始游戏] 按钮（仅房主可见，需所有人准备）
```

**流程：**
1. 玩家陆续加入（2-4人）
2. 每个人点击"准备"
3. 当所有人准备完成时，房主可点击"开始游戏"
4. 开始游戏 → 跳转到[游戏主界面]

---

### 3. 游戏主界面（10回合循环）

#### 🎯 页面布局
```
┌─────────────────────────────────────────────────────────┐
│  [顶部状态栏]                                            │
│  回合: 1/10 | 现金: ¥10,000 | 我的昵称                   │
├─────────────────────────────────────────────────────────┤
│  [左侧：操作面板]          │  [右侧：信息面板]           │
│                            │                            │
│  1️⃣ 开店决策               │  📊 财务报表                │
│  2️⃣ 人力管理               │  📈 销售数据                │
│  3️⃣ 市场决策               │  🏆 排行榜                 │
│  4️⃣ 研发决策               │                            │
│  5️⃣ 生产决策               │                            │
│                            │                            │
│  [提交决策] 按钮           │                            │
└─────────────────────────────────────────────────────────┘
```

---

## 📋 详细功能设计

### 模块1️⃣：开店决策
```
[首次显示 - 第1回合]
├─ 输入租金（线下抽卡获得）
├─ 选择装修等级
│   ○ 简装 - 400元（2员工）
│   ○ 精装 - 800元（3员工）
│   ○ 豪华装 - 1600元（4员工）
└─ [确认开店] 按钮

[已开店后]
└─ 显示：店铺信息（租金、装修等级、员工容量）
```

**API调用：**
- POST `/api/v1/shops/open`

---

### 模块2️⃣：人力管理
```
[员工列表]
显示：姓名、工资、生产力、状态

[招聘员工]（如果未达上限）
├─ 输入：姓名、工资、生产力（线下抽卡）
└─ [招聘] 按钮

[解雇员工]
└─ [解雇] 按钮（每个员工旁边）

[总生产力显示]
└─ 当前总生产力：XX 杯
```

**API调用：**
- POST `/api/v1/employees/hire`
- POST `/api/v1/employees/{id}/fire`
- GET `/api/v1/employees/player/{player_id}`

---

### 模块3️⃣：市场决策
```
[市场调研]
├─ 费用：500元
├─ [执行调研] 按钮
└─ 显示结果：下回合客流量
    - 高购买力客户：XX人
    - 低购买力客户：XX人

[广告投放]
├─ 选择产品（下拉框）
├─ 费用：800元
├─ 输入骰子点数（1-6）
└─ [投放广告] 按钮
```

**API调用：**
- POST `/api/v1/market/research`
- POST `/api/v1/market/advertisement`

---

### 模块4️⃣：研发决策
```
[产品配方列表]
显示7种产品：

┌──────────────────────────────────────┐
│ ✓ 奶茶 (已解锁)                       │
│   圈粉率: 5% | 配方: 1茶1奶           │
├──────────────────────────────────────┤
│ ✗ 珍珠奶茶 (未解锁)                   │
│   难度: ≥3 | 费用: 600元             │
│   [研发] 按钮                         │
└──────────────────────────────────────┘

[研发流程]
1. 点击[研发]按钮
2. 扣除600元
3. 弹窗：输入骰子点数（1-6）
4. 显示结果：成功 / 失败
5. 成功 → 产品解锁 → 可用于生产
```

**API调用：**
- POST `/api/v1/products/research`
- GET `/api/v1/products/recipes?player_id={player_id}`

---

### 模块5️⃣：生产决策（核心）
```
[已解锁产品列表]
显示每个产品：

┌──────────────────────────────────────────────┐
│ 奶茶 (圈粉率: 5%, 累计销售: 30杯)            │
│ ├─ 分配生产力：[____] 杯                     │
│ ├─ 定价：[____] 元 (10-40, 5的倍数)         │
│ ├─ 原料需求：茶叶X份、牛奶X份               │
│ └─ 预计成本：XXX元                           │
├──────────────────────────────────────────────┤
│ 珍珠奶茶 (圈粉率: 20%, 累计销售: 10杯)      │
│ ├─ 分配生产力：[____] 杯                     │
│ ...                                           │
└──────────────────────────────────────────────┘

[底部汇总]
├─ 已分配生产力：XX / XX
├─ 原材料总成本：XXX元（含折扣）
└─ [预览成本] 按钮

[限制]
- 总生产力不能超过员工生产力之和
- 定价：10-40元，5的倍数
- 定价锁定：每3回合才能改
```

**API调用：**
- POST `/api/v1/production/material-preview` (预览)
- POST `/api/v1/production/submit` (提交)

---

## 🔄 回合流程控制

### 单回合流程
```
[回合开始]
  ↓
[所有玩家进行决策]
  - 开店（仅第1回合）
  - 招聘员工
  - 市场调研/广告
  - 产品研发
  - 生产计划（必须）
  ↓
[玩家点击"提交决策"]
  - 前端验证
  - API调用 → 保存决策
  - 显示"等待其他玩家..."
  ↓
[等待所有玩家提交]
  - 实时显示：X/4 玩家已完成
  ↓
[所有人完成后，自动推进回合]
  - 调用 POST /api/v1/rounds/{game_id}/advance
  - 后端计算：
    ✓ 生成客流
    ✓ 分配客户
    ✓ 计算销售
    ✓ 生成财务报表
  ↓
[显示本回合结果]
  - 销售数据
  - 财务报表
  - 排行榜
  ↓
[进入下一回合]
  - 回合数 +1
  - 重复流程
```

---

## 🎨 页面设计

### 页面1：首页
```
┌─────────────────────────────────────┐
│                                     │
│         🧋 奶茶大作战                │
│                                     │
│   ┌──────────────────────────┐     │
│   │   [创建房间]              │     │
│   └──────────────────────────┘     │
│                                     │
│   ┌──────────────────────────┐     │
│   │   [加入房间]              │     │
│   └──────────────────────────┘     │
│                                     │
└─────────────────────────────────────┘
```

### 页面2：创建/加入房间弹窗
```
[创建房间]
┌─────────────────────────────┐
│ 请输入您的昵称：            │
│ [___________________]       │
│                             │
│ 房间人数上限：              │
│ ○ 2人  ○ 3人  ● 4人        │
│                             │
│ [确定]  [取消]              │
└─────────────────────────────┘

[加入房间]
┌─────────────────────────────┐
│ 请输入房间码：              │
│ [______] (6位大写字母)      │
│                             │
│ 请输入您的昵称：            │
│ [___________________]       │
│                             │
│ [加入]  [取消]              │
└─────────────────────────────┘
```

### 页面3：房间准备
```
┌─────────────────────────────────────┐
│ 房间码: ABCDEF       [复制]         │
├─────────────────────────────────────┤
│ 玩家列表 (2/4)                      │
│ ┌─────────────────────────────┐    │
│ │ 👤 玩家1 (房主)  ✅ 已准备   │    │
│ │ 👤 玩家2         ⏳ 未准备   │    │
│ │ 👤 等待加入...               │    │
│ │ 👤 等待加入...               │    │
│ └─────────────────────────────┘    │
│                                     │
│ [准备] / [取消准备]                 │
│ [开始游戏] (房主，所有人准备后)     │
└─────────────────────────────────────┘
```

### 页面4：游戏主界面
```
┌─────────────────────────────────────────────────────────┐
│ 🎮 第1回合/10 | 💰 现金: ¥10,000 | 👤 玩家1            │
├──────────────────────┬──────────────────────────────────┤
│ [操作面板]           │ [信息面板]                        │
│                      │                                   │
│ 📍 开店决策          │ 📊 本回合财务                     │
│ 👥 人力管理          │ ├─ 收入: ¥XXX                    │
│ 📢 市场决策          │ ├─ 支出: ¥XXX                    │
│ 🔬 研发决策          │ └─ 利润: ¥XXX                    │
│ 🏭 生产决策 ⚠️       │                                   │
│                      │ 🏆 当前排名                       │
│ ┌──────────────────┐│ 1. 玩家1 - ¥5000                 │
│ │ [提交决策]       ││ 2. 玩家2 - ¥4500                 │
│ │ (需完成生产计划) ││ 3. 玩家3 - ¥4000                 │
│ └──────────────────┘│ 4. 玩家4 - ¥3500                 │
│                      │                                   │
│ 等待玩家: 2/4 ⏳     │                                   │
└──────────────────────┴──────────────────────────────────┘
```

---

## 🔧 技术栈

### 前端框架
- **React 18** + **TypeScript**
- **Vite** (构建工具)
- **Ant Design** (UI组件库)
- **Zustand** (状态管理)
- **React Router** (路由)
- **Axios** (HTTP请求)
- **Socket.IO Client** (实时通信，可选)

### 状态管理设计
```typescript
// Zustand Store 结构
interface GameStore {
  // 玩家信息
  currentPlayer: Player | null;

  // 房间信息
  roomCode: string;
  gameId: number;

  // 游戏状态
  currentRound: number;
  gameStatus: 'waiting' | 'in_progress' | 'finished';

  // 玩家决策
  shopDecision: ShopDecision | null;
  employees: Employee[];
  productions: Production[];

  // Actions
  setPlayer: (player: Player) => void;
  submitProduction: (productions: Production[]) => void;
  advanceRound: () => void;
  ...
}
```

---

## 🔄 实时同步方案

### 方案A：轮询（简单）
```typescript
// 每3秒轮询一次，检查其他玩家状态
useEffect(() => {
  const interval = setInterval(() => {
    checkPlayersReady();
  }, 3000);
  return () => clearInterval(interval);
}, []);
```

### 方案B：WebSocket（推荐）
```typescript
// 使用 Socket.IO 实现实时推送
socket.on('player_ready', (data) => {
  updatePlayerStatus(data.playerId, 'ready');
});

socket.on('round_advanced', (data) => {
  loadRoundResults(data.roundNumber);
});
```

---

## 📱 响应式设计

- **桌面端优先**（游戏主要在电脑上玩）
- **最小宽度**：1280px
- **平板/手机**：简化布局（可选）

---

## 🎯 开发优先级

### 阶段1：核心流程（MVP）
1. ✅ 创建/加入房间
2. ✅ 房间准备页
3. ✅ 游戏主界面框架
4. ✅ 生产决策模块（核心）
5. ✅ 回合推进逻辑

### 阶段2：完整功能
6. 开店决策
7. 人力管理
8. 市场决策
9. 研发决策
10. 财务报表

### 阶段3：优化
11. 实时同步（WebSocket）
12. 动画效果
13. 音效
14. 数据可视化

---

## 📁 文件结构

```
frontend/
├── src/
│   ├── pages/
│   │   ├── Home.tsx              # 首页
│   │   ├── RoomLobby.tsx         # 房间准备
│   │   └── Game.tsx              # 游戏主界面
│   ├── components/
│   │   ├── Shop/                 # 开店模块
│   │   ├── Employee/             # 员工模块
│   │   ├── Market/               # 市场模块
│   │   ├── Research/             # 研发模块
│   │   ├── Production/           # 生产模块
│   │   └── Finance/              # 财务模块
│   ├── stores/
│   │   └── gameStore.ts          # Zustand状态管理
│   ├── services/
│   │   └── api.ts                # API调用封装
│   ├── types/
│   │   └── game.d.ts             # TypeScript类型定义
│   └── App.tsx
├── package.json
└── vite.config.ts
```

---

**文档创建时间**: 2025-11-19
**前端技术栈**: React 18 + TypeScript + Vite + Ant Design
**后端API**: Flask 3.0 (已完成)
